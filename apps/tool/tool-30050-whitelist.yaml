---
# NetworkPolicy để chặn traffic đến pod tool-service từ IP không được phép
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: tool-service-30050-whitelist
  namespace: web-stock-future
spec:
  podSelector:
    matchLabels:
      app: tool-service
  policyTypes:
  - Ingress
  ingress:
  # Cho phép traffic từ các IP được whitelist
  - from:
    - ipBlock:
        cidr: 14.191.166.230/32  # IP của bạn
    - ipBlock:
        cidr: 127.0.0.1/32       # Local
    - ipBlock:
        cidr: 10.42.0.0/16       # K3s internal
    - ipBlock:
        cidr: 192.168.0.0/16     # LAN internal
    - ipBlock:
        cidr: 172.16.0.0/12      # Docker internal
    ports:
    - protocol: TCP
      port: 9999
  # Cho phép traffic nội bộ namespace (để services khác vẫn giao tiếp được)
  - from:
    - namespaceSelector:
        matchLabels:
          name: web-stock-future
    - podSelector: {}